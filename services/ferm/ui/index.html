<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ—Ä–º–∞ - –ú—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è</title>
    <link rel="stylesheet" href="/ferm/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>–§–µ—Ä–º–∞ - –ú—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è</h1>
            <div style="display: flex; align-items: center; gap: 16px;">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span>–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
                </div>
                <span id="currentUsername" style="color: #94a3b8; font-size: 12px;"></span>
                <button class="btn-secondary" onclick="window.open('/', '_blank')" style="padding: 6px 12px; font-size: 12px;">–ì–ª–∞–≤–Ω–∞—è</button>
                <button id="adminPanelButton" class="btn-secondary" onclick="openAdminPanel()" style="padding: 6px 12px; font-size: 12px; display: none;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                <button class="btn-danger" onclick="logout()" style="padding: 6px 12px; font-size: 12px;">–í—ã–π—Ç–∏</button>
            </div>
        </header>

        <div class="main-content">
            <!-- –ü–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü: –ê–∫–∫–∞—É–Ω—Ç—ã -->
            <div class="accounts-column">
                <section class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2>üë• –ê–∫–∫–∞—É–Ω—Ç—ã</h2>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É) -->
                            <div class="total-balance-card" style="padding: 6px 10px; background: #0f172a; border: 1px solid #334155; border-radius: 4px; display: flex; align-items: center; gap: 6px;">
                                <span style="font-size: 10px; color: #94a3b8;">–ë–∞–ª–∞–Ω—Å:</span>
                                <span id="totalBalance" style="font-size: 14px; font-weight: 700; color: #60a5fa;">-</span>
                                <span style="font-size: 9px; color: #64748b;">USDT</span>
                            </div>
                            <button class="btn-success btn-small" onclick="showAddAccountModal()" style="padding: 4px 12px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ -->
                    <div class="quick-actions" style="margin-bottom: 12px; grid-template-columns: repeat(6, 1fr);">
                        <button class="btn-secondary quick-btn" onclick="selectAllAccounts()">‚úì –í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                        <button class="btn-secondary quick-btn" onclick="deselectAllAccounts()">‚úó –°–Ω—è—Ç—å –≤—Å–µ</button>
                        <button class="btn-info quick-btn" onclick="checkAllAccounts()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ</button>
                        <button class="btn-info quick-btn" onclick="refreshBalancesForSelected()">–ë–∞–ª–∞–Ω—Å—ã</button>
                        <button class="btn-success quick-btn" onclick="exportAccounts()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                        <button class="btn-warning quick-btn" onclick="importAccounts()">–ò–º–ø–æ—Ä—Ç</button>
                        <input type="file" id="importFileInput" accept=".txt" style="display: none;" onchange="handleFileImport(event)">
                    </div>
                    
                    <!-- –ü–æ–ª–∑—É–Ω–æ–∫ –∏ –≥—Ä—É–ø–ø—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤ -->
                    <div style="display: none; align-items: center; gap: 10px; margin-bottom: 12px; flex-direction: row;" id="accountSelectorSlider">
                        <!-- –ü–æ–ª–∑—É–Ω–æ–∫ (—É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–π) -->
                        <div class="account-selector-slider" style="flex: 0 0 auto; width: 50%; max-width: 350px; min-width: 180px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                <label for="accountRangeSlider" style="font-size: 12px; color: white; font-weight: 500;">–í—ã–±—Ä–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã:</label>
                                <span id="selectedAccountsCount" style="font-size: 12px; color: #60a5fa; font-weight: 600;">0 / 0</span>
                            </div>
                            <input type="range" id="accountRangeSlider" min="0" max="0" value="0" 
                                   oninput="handleAccountSliderChange(this.value)" />
                            <div style="display: flex; justify-content: space-between; font-size: 10px; color: #94a3b8; margin-top: 4px;">
                                <span>0</span>
                                <span id="sliderMiddleValue" style="color: #64748b;">0</span>
                                <span id="sliderMaxValue">0</span>
                            </div>
                        </div>
                        
                        <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (2x2 grid) -->
                        <div class="account-groups-panel" style="display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 4px; flex: 0 0 auto; width: 60px;">
                            <button class="account-group-btn" onclick="selectAccountGroup(1)" style="padding: 4px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; min-width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">1</button>
                            <button class="account-group-btn" onclick="selectAccountGroup(2)" style="padding: 4px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; min-width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">2</button>
                            <button class="account-group-btn" onclick="selectAccountGroup(3)" style="padding: 4px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; min-width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">3</button>
                            <button class="account-group-btn" onclick="selectAccountGroup(4)" style="padding: 4px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; min-width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">4</button>
                        </div>
                    </div>
                    
                    <!-- –°–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ -->
                    <div id="accountsList" class="accounts-list">
                        <div class="empty-state">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" –¥–ª—è –Ω–∞—á–∞–ª–∞.</div>
                    </div>
                </section>
            </div>

            <!-- –í—Ç–æ—Ä–æ–π —Å—Ç–æ–ª–±–µ—Ü: –¢–æ—Ä–≥–æ–≤–ª—è -->
            <div class="trading-column">
                <!-- –í—ã–±–æ—Ä –º–æ–Ω–µ—Ç—ã -->
                <section class="card">
                    <h2>–ú–æ–Ω–µ—Ç–∞</h2>
                    <div class="form-group">
                        <label for="customSymbol">–°–∏–º–≤–æ–ª:</label>
                        <input type="text" id="customSymbol" class="highlighted-input" placeholder="UNI_USDT" onchange="loadMarketData()" />
                    </div>
                </section>

                <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞ -->
                <section class="card">
                    <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞</h2>
                    
                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="orderSide">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                            <select id="orderSide" onchange="updateOrderSideHint()">
                                <option value="1">–û—Ç–∫—Ä—ã—Ç—å –ª–æ–Ω–≥</option>
                                <option value="3">–û—Ç–∫—Ä—ã—Ç—å —à–æ—Ä—Ç</option>
                                <option value="4">–ó–∞–∫—Ä—ã—Ç—å –ª–æ–Ω–≥</option>
                                <option value="2">–ó–∞–∫—Ä—ã—Ç—å —à–æ—Ä—Ç</option>
                            </select>
                        </div>
                        <div>
                            <label for="orderType">–¢–∏–ø:</label>
                            <select id="orderType" onchange="updateOrderTypeHint()">
                                <option value="5">Market</option>
                                <option value="1">Limit</option>
                                <option value="3">IOC</option>
                                <option value="4">FOK</option>
                                <option value="2">Post Only</option>
                                <option value="6">Convert</option>
                            </select>
                        </div>
                        <div>
                            <label for="openType">–ú–∞—Ä–∂–∞:</label>
                            <select id="openType" onchange="updateVolumeCalculations()">
                                <option value="1">Isolated</option>
                                <option value="2">Cross</option>
                            </select>
                        </div>
                    </div>
                    <div id="orderHint" class="hint" style="margin-top: 4px; padding: 4px 6px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; font-size: 11px; color: #60a5fa;"></div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="leverage">–ü–ª–µ—á–æ:</label>
                            <div style="display: flex; gap: 4px;">
                                <input type="number" id="leverage" min="1" max="125" value="10" onchange="updateVolumeCalculations()" style="flex: 1;" />
                                <button class="btn-small" onclick="applyLeverage()" style="margin: 0; white-space: nowrap; padding: 4px 8px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                        <div>
                            <label for="price">–¶–µ–Ω–∞: <span id="priceHint" style="font-size: 10px; color: white;">(Market: 0)</span></label>
                            <div style="display: flex; gap: 4px;">
                                <input type="number" id="price" step="0.01" placeholder="–ê–≤—Ç–æ" oninput="updateVolumeCalculations()" style="flex: 1;" />
                                <button class="btn-small" onclick="setCurrentPrice()" style="margin: 0; padding: 4px 8px;">–¢–µ–∫—É—â–∞—è</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–û–±—ä–µ–º:</label>
                        <div style="display: flex; gap: 6px; margin-bottom: 4px; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px; margin: 0;">
                                <input type="radio" name="volumeType" value="usdt" checked onchange="updateVolumeType()" />
                                <span>USDT</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px; margin: 0;">
                                <input type="radio" name="volumeType" value="coins" onchange="updateVolumeType()" />
                                <span>–ö–æ–∏–Ω—ã</span>
                            </label>
                            <div style="flex: 1; display: flex; gap: 4px; justify-content: flex-end;">
                                <button class="btn-small" onclick="setVolumePercent(25)" style="margin: 0; padding: 2px 6px; font-size: 10px;">25%</button>
                                <button class="btn-small" onclick="setVolumePercent(50)" style="margin: 0; padding: 2px 6px; font-size: 10px;">50%</button>
                                <button class="btn-small" onclick="setVolumePercent(100)" style="margin: 0; padding: 2px 6px; font-size: 10px;">100%</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="number" id="volume" class="highlighted-input volume-input" step="0.001" placeholder="0.001" oninput="updateVolumeCalculations()" />
                            <span id="volumeUnit" style="font-size: 11px; color: white; margin-left: 4px; white-space: nowrap;">USDT</span>
                        </div>
                        <div id="volumeCalculations" style="margin-top: 4px; padding: 4px 6px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; font-size: 11px; color: #60a5fa;">
                            <div>–†–∞—Å—á–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –æ–±—ä–µ–º–∞</div>
                        </div>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="stopLossPrice">–°—Ç–æ–ø-–ª–æ—Å—Å:</label>
                            <input type="number" id="stopLossPrice" step="0.01" placeholder="–û–ø—Ü." />
                        </div>
                        <div>
                            <label for="takeProfitPrice">–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç:</label>
                            <input type="number" id="takeProfitPrice" step="0.01" placeholder="–û–ø—Ü." />
                        </div>
                        <div>
                            <label for="positionMode">–†–µ–∂–∏–º:</label>
                            <select id="positionMode">
                                <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                                <option value="1">Hedge</option>
                                <option value="2">One-way</option>
                            </select>
                        </div>
                    </div>

                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è: Position ID, Reduce Only, External ID -->
                    <div class="form-group" style="display: none;">
                        <div>
                            <label for="positionId">Position ID:</label>
                            <input type="number" id="positionId" placeholder="–û–ø—Ü." />
                        </div>
                        <div>
                            <label style="margin: 0; display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="reduceOnly" style="margin-right: 4px;" />
                                <span style="font-size: 11px;">Reduce Only</span>
                            </label>
                        </div>
                        <div>
                            <label for="externalOid" style="font-size: 11px;">External ID:</label>
                            <input type="text" id="externalOid" placeholder="–û–ø—Ü." style="font-size: 11px;" />
                        </div>
                    </div>
                </section>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <section class="card">
                    <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="quick-actions">
                        <button class="btn-success quick-btn" onclick="quickLongOnSelectedAccounts()">LONG</button>
                        <button class="btn-danger quick-btn" onclick="quickShortOnSelectedAccounts()">SHORT</button>
                        <button class="btn-warning quick-btn" onclick="quickCloseOnSelectedAccounts()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </section>

                <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                <section class="card">
                    <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="action-buttons">
                        <button class="btn-success" onclick="submitOrderToSelectedAccounts()">–°–æ–∑–¥–∞—Ç—å –æ—Ä–¥–µ—Ä</button>
                        <button class="btn-danger" onclick="cancelAllOrdersOnSelectedAccounts()">–û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
                        <button class="btn-warning" onclick="closePositionsOnSelectedAccounts()">–ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏–∏</button>
                    </div>
                    
                    <!-- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π -->
                    <div class="form-group" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #334155;">
                        <label style="margin-bottom: 8px; display: block; font-size: 12px; color: #94a3b8;">–ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π:</label>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <input type="range" id="partialCloseSlider" min="0" max="100" value="50" step="1" 
                                   style="flex: 1; height: 6px; background: #334155; border-radius: 3px; outline: none; cursor: pointer;"
                                   oninput="updatePartialClosePercent(this.value)" />
                            <span id="partialClosePercent" style="min-width: 50px; text-align: center; font-weight: 600; color: #60a5fa; font-size: 14px;">50%</span>
                            <button class="btn-warning" onclick="partialClosePositionsOnSelectedAccounts()" style="padding: 6px 16px; font-size: 12px;">–ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                        <div style="margin-top: 4px; font-size: 10px; color: #64748b; text-align: center;">
                            –ó–∞–∫—Ä–æ–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞—Ö
                        </div>
                    </div>
                </section>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π -->
                <section class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                        <button class="btn-small btn-secondary" onclick="clearOperationHistory()" style="padding: 4px 8px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                    <div id="operationResults" class="operation-results">
                        <div class="empty-state">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</div>
                    </div>
                </section>
            </div>
        </div>
    </div>


    <script src="/ferm/app.js"></script>
</body>
</html>
