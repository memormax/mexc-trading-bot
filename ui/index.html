<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEXC Futures Trading Bot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Unified Trading Bot - Manual & Arbitrage</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot"></span>
                <span>–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            </div>
        </header>

        <div class="main-content">
            <!-- –ü–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü: –°—Ç–∞—Ç—É—Å –∞—Ä–±–∏—Ç—Ä–∞–∂–∞, –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥, –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ -->
            <div class="left-panel">
                <!-- –°—Ç–∞—Ç—É—Å –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ -->
                <section class="card">
                    <h2>üîå –°—Ç–∞—Ç—É—Å –∞—Ä–±–∏—Ç—Ä–∞–∂–∞</h2>
                    <div id="arbitrageStatus" class="info-display">
                        <p>–ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω</p>
                    </div>
                    <div class="action-buttons" style="margin-top: 8px;">
                        <button class="btn-success" onclick="startArbitrageBot()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                        <button class="btn-danger" onclick="stopArbitrageBot()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button class="btn-warning" onclick="restartArbitrageBot()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                    </div>
                    <div class="action-buttons" style="margin-top: 8px;">
                        <button class="btn-secondary" onclick="restartServer()" style="width: 100%;">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
                    </div>
                </section>

                <!-- –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥ -->
                <section class="card">
                    <h2>üìä –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥ <button class="btn-small refresh-btn" onclick="updateSpread()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="spreadInfo" class="info-display">
                        <p>–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>
                </section>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ -->
                <section class="card">
                    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞</h2>
                    <div class="form-group">
                        <label for="minTicks">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (—Ç–∏–∫–∏):</label>
                        <input type="number" id="minTicks" value="2" min="1" />
                    </div>
                    <div class="form-group">
                        <label for="maxSlippage">–ú–∞–∫—Å. –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (%):</label>
                        <input type="number" id="maxSlippage" value="0.1" step="0.01" min="0" />
                        <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π. –ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
                        </div>
                    </div>
                    <div style="font-size: 11px; color: #60a5fa; margin-top: 8px; padding: 6px; background: #1e293b; border: 1px solid #334155; border-radius: 4px;">
                        <strong>üí° –û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏</strong> –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ <strong>"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞"</strong> (–ø–æ–ª–µ "–û–±—ä–µ–º" –≤ USDT). –≠—Ç–æ—Ç –æ–±—ä–µ–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞.
                    </div>
                    <button class="btn-primary" onclick="saveArbitrageSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </section>

                <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ —Å –∫–æ–º–∏—Å—Å–∏–µ–π (—á–µ—Ä–µ–∑ API –∫–ª—é—á–∏) -->
                <section class="card">
                    <h2>üí∞ –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (API) <button class="btn-secondary btn-small refresh-btn" onclick="loadTradeHistory()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="tradeHistoryInfo" class="info-display">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç—Ä–µ–±—É—é—Ç—Å—è API –∫–ª—é—á–∏)</p>
                    </div>
                </section>
            </div>

            <!-- –í—Ç–æ—Ä–æ–π —Å—Ç–æ–ª–±–µ—Ü: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞, –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="middle-panel">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
                <section class="card">
                    <h2>üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
                    <div class="form-group" style="display: flex; gap: 4px; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label for="authToken">WEB Token:</label>
                            <input type="password" id="authToken" placeholder="WEB_..." />
                        </div>
                        <button class="btn-secondary" onclick="toggleTokenVisibility()" style="margin-bottom: 0; padding: 4px 8px;">üëÅÔ∏è</button>
                    </div>
                    <div class="form-group" style="display: flex; gap: 4px;">
                        <button class="btn-primary" onclick="setAuthToken()" style="flex: 1; padding: 6px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn-secondary" onclick="testConnection()" style="flex: 1; padding: 6px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                    
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #334155;">
                        <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">API –∫–ª—é—á–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–∏—Å—Å–∏–∏):</div>
                        <div class="form-group">
                            <label for="apiKey">API Key:</label>
                            <input type="password" id="apiKey" placeholder="–í–∞—à API Key" />
                        </div>
                        <div class="form-group">
                            <label for="apiSecret">API Secret:</label>
                            <input type="password" id="apiSecret" placeholder="–í–∞—à API Secret" />
                        </div>
                        <div class="form-group" style="display: flex; gap: 4px;">
                            <button class="btn-primary" onclick="setApiKeys()" style="flex: 1; padding: 6px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button class="btn-secondary" onclick="testApiKeys()" style="flex: 1; padding: 6px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                        </div>
                    </div>
                </section>

                <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
                <section class="card">
                    <h2>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞</h2>
                    
                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="orderSide">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                            <select id="orderSide" onchange="updateOrderSideHint()">
                                <option value="1">üìà –û—Ç–∫—Ä—ã—Ç—å –ª–æ–Ω–≥</option>
                                <option value="3">üìâ –û—Ç–∫—Ä—ã—Ç—å —à–æ—Ä—Ç</option>
                                <option value="4">üîí –ó–∞–∫—Ä—ã—Ç—å –ª–æ–Ω–≥</option>
                                <option value="2">üîí –ó–∞–∫—Ä—ã—Ç—å —à–æ—Ä—Ç</option>
                            </select>
                        </div>
                        <div>
                            <label for="orderType">–¢–∏–ø:</label>
                            <select id="orderType" onchange="updateOrderTypeHint()">
                                <option value="5">‚ö° Market</option>
                                <option value="1">üìä Limit</option>
                                <option value="3">‚è±Ô∏è IOC</option>
                                <option value="4">üéØ FOK</option>
                                <option value="2">üìù Post Only</option>
                                <option value="6">üîÑ Convert</option>
                            </select>
                        </div>
                        <div>
                            <label for="openType">–ú–∞—Ä–∂–∞:</label>
                            <select id="openType" onchange="updateVolumeCalculations()">
                                <option value="1">Isolated</option>
                                <option value="2">Cross</option>
                            </select>
                        </div>
                    </div>
                    <div id="orderHint" class="hint" style="margin-top: 4px; padding: 4px 6px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; font-size: 11px; color: #60a5fa;"></div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="leverage">–ü–ª–µ—á–æ:</label>
                            <div style="display: flex; gap: 4px;">
                                <input type="number" id="leverage" min="1" max="125" value="10" onchange="updateVolumeCalculations()" style="flex: 1;" />
                                <button class="btn-small" onclick="applyLeverage()" style="margin: 0; white-space: nowrap; padding: 4px 8px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                        <div>
                            <label for="price">–¶–µ–Ω–∞: <span id="priceHint" style="font-size: 10px; color: white;">(Market: 0)</span></label>
                            <div style="display: flex; gap: 4px;">
                                <input type="number" id="price" step="0.01" placeholder="–ê–≤—Ç–æ" oninput="updateVolumeCalculations()" style="flex: 1;" />
                                <button class="btn-small" onclick="setCurrentPrice()" style="margin: 0; padding: 4px 8px;">üìå</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–û–±—ä–µ–º:</label>
                        <div style="display: flex; gap: 6px; margin-bottom: 4px; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px; margin: 0;">
                                <input type="radio" name="volumeType" value="usdt" checked onchange="updateVolumeType()" />
                                <span>USDT</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px; margin: 0;">
                                <input type="radio" name="volumeType" value="coins" onchange="updateVolumeType()" />
                                <span>–ö–æ–∏–Ω—ã</span>
                            </label>
                            <div style="flex: 1; display: flex; gap: 4px; justify-content: flex-end;">
                                <button class="btn-small" onclick="setVolumePercent(25)" style="margin: 0; padding: 2px 6px; font-size: 10px;">25%</button>
                                <button class="btn-small" onclick="setVolumePercent(50)" style="margin: 0; padding: 2px 6px; font-size: 10px;">50%</button>
                                <button class="btn-small" onclick="setVolumePercent(100)" style="margin: 0; padding: 2px 6px; font-size: 10px;">100%</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="number" id="volume" step="0.001" placeholder="0.001" oninput="updateVolumeCalculations()" style="flex: 1;" />
                            <span id="volumeUnit" style="font-size: 11px; color: white; margin-left: 4px; white-space: nowrap;">USDT</span>
                        </div>
                        <div id="volumeCalculations" style="margin-top: 4px; padding: 4px 6px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; font-size: 11px; color: #60a5fa;">
                            <div>–†–∞—Å—á–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –æ–±—ä–µ–º–∞</div>
                        </div>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="stopLossPrice">–°—Ç–æ–ø-–ª–æ—Å—Å:</label>
                            <input type="number" id="stopLossPrice" step="0.01" placeholder="–û–ø—Ü." />
                        </div>
                        <div>
                            <label for="takeProfitPrice">–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç:</label>
                            <input type="number" id="takeProfitPrice" step="0.01" placeholder="–û–ø—Ü." />
                        </div>
                        <div>
                            <label for="positionMode">–†–µ–∂–∏–º:</label>
                            <select id="positionMode">
                                <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                                <option value="1">Hedge</option>
                                <option value="2">One-way</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                        <div>
                            <label for="positionId">Position ID:</label>
                            <input type="number" id="positionId" placeholder="–û–ø—Ü." />
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 6px;">
                            <label style="margin: 0; display: flex; align-items: center; cursor: pointer; flex: 1;">
                                <input type="checkbox" id="reduceOnly" style="margin-right: 4px;" />
                                <span style="font-size: 11px;">Reduce Only</span>
                            </label>
                            <div style="flex: 1;">
                                <label for="externalOid" style="font-size: 11px;">External ID:</label>
                                <input type="text" id="externalOid" placeholder="–û–ø—Ü." style="font-size: 11px;" />
                            </div>
                        </div>
                    </div>
                </section>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <section class="card">
                    <h2>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="quick-actions">
                        <button class="btn-success quick-btn" onclick="quickLong()">üìà –õ–û–ù–ì</button>
                        <button class="btn-danger quick-btn" onclick="quickShort()">üìâ –®–û–†–¢</button>
                        <button class="btn-warning quick-btn" onclick="quickClose()">üîí –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #334155;">
                        <div class="action-buttons">
                            <button class="btn-success" onclick="submitOrder()">üìà –°–æ–∑–¥–∞—Ç—å –æ—Ä–¥–µ—Ä</button>
                            <button class="btn-danger" onclick="cancelAllOrders()">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- –¢—Ä–µ—Ç–∏–π —Å—Ç–æ–ª–±–µ—Ü: –ú–æ–Ω–µ—Ç–∞, –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π, –ë–∞–ª–∞–Ω—Å, –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –ò—Å—Ç–æ—Ä–∏—è –æ—Ä–¥–µ—Ä–æ–≤ -->
            <div class="right-panel">
                <!-- –í—ã–±–æ—Ä –º–æ–Ω–µ—Ç—ã -->
                <section class="card">
                    <h2>üìä –ú–æ–Ω–µ—Ç–∞</h2>
                    <div class="form-group">
                        <label for="symbol">–°–∏–º–≤–æ–ª:</label>
                        <select id="symbol" onchange="loadMarketData()">
                            <option value="BTC_USDT">BTC/USDT</option>
                            <option value="ETH_USDT">ETH/USDT</option>
                            <option value="BNB_USDT">BNB/USDT</option>
                            <option value="SOL_USDT">SOL/USDT</option>
                            <option value="XRP_USDT">XRP/USDT</option>
                            <option value="ADA_USDT">ADA/USDT</option>
                            <option value="DOGE_USDT">DOGE_USDT</option>
                            <option value="MATIC_USDT">MATIC/USDT</option>
                            <option value="DOT_USDT">DOT/USDT</option>
                            <option value="LINK_USDT">LINK/USDT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="customSymbol">–ò–ª–∏ —Å–≤–æ–π:</label>
                        <input type="text" id="customSymbol" placeholder="CAKE_USDT" onchange="loadMarketData()" />
                    </div>
                </section>

                <!-- –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                <section class="card">
                    <h2>üìä –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ <button class="btn-small refresh-btn" onclick="loadMarketData()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="marketData" class="market-data-compact"></div>
                </section>

                <!-- –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π -->
                <section class="card">
                    <h2>üìù –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                    <div id="log" class="log-display"></div>
                    <button class="btn-small" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
                </section>
                <!-- –ë–∞–ª–∞–Ω—Å -->
                <section class="card">
                    <h2>üí∞ –ë–∞–ª–∞–Ω—Å <button class="btn-info btn-small refresh-btn" onclick="refreshBalance()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="balanceInfo" class="info-display">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    </div>
                </section>

                <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ -->
                <section class="card">
                    <h2>üìä –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ <button class="btn-warning btn-small refresh-btn" onclick="refreshPositions()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="positionsInfo" class="info-display">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    </div>
                </section>

                <!-- –ò—Å—Ç–æ—Ä–∏—è –æ—Ä–¥–µ—Ä–æ–≤ -->
                <section class="card">
                    <h2>üìã –ò—Å—Ç–æ—Ä–∏—è –æ—Ä–¥–µ—Ä–æ–≤ <button class="btn-secondary btn-small refresh-btn" onclick="loadOrderHistory()" style="margin: 0; padding: 2px 6px;">üîÑ</button></h2>
                    <div id="orderHistoryInfo" class="info-display">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="arbitrage-functions.js"></script>
</body>
</html>
