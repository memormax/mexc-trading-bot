# –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–æ—Ä–≥–æ–≤–ª–µ–π - –ó–ê–í–ï–†–®–ï–ù–ê ‚úÖ

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–í—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ –§–∞–∑—ã 3 **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 759-771

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏ (`stopAfterClose = true`) –±–æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç –≤–º–µ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏ (–æ–Ω–∏ –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
- –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ

**–ö–æ–¥:**
```typescript
if (stopAfterClose) {
  if (multiAccountConfig.enabled) {
    await switchToNextAccount('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–æ–º–∏—Å—Å–∏—è');
    return; // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å
  }
  // –û–±—ã—á–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –µ—Å–ª–∏ –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–∏–Ω–≥ –≤—ã–∫–ª—é—á–µ–Ω
}
```

---

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 296-317

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å, rate limiting) –±–æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é:
  - `Balance insufficient`
  - `insufficient`
  - `Requests are too frequent`

**–ö–æ–¥:**
```typescript
catch (error: any) {
  if (multiAccountConfig.enabled) {
    const isCriticalError = error.message?.includes('Balance insufficient') || 
                            error.message?.includes('insufficient') ||
                            error.message?.includes('Requests are too frequent');
    
    if (isCriticalError) {
      await switchToNextAccount(`–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: ${error.message}`);
    }
  }
}
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ < 0.5 USDT ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 2158-2162

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
- –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å < 0.5 USDT, –±–æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç

**–ö–æ–¥:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ë–∞–ª–∞–Ω—Å < 0.5 USDT
if (balance < 0.5) {
  await switchToNextAccount('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å (< 0.5 USDT)');
  return;
}
```

---

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 2164-2169

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
- –ï—Å–ª–∏ –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏ >= `maxTradingTimeMinutes`, –±–æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç

**–ö–æ–¥:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –í—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏ >= maxTradingTimeMinutes
if (currentAccount.startTime && multiAccountConfig.maxTradingTimeMinutes > 0) {
  const tradingTimeMinutes = (Date.now() - currentAccount.startTime) / 60000;
  if (tradingTimeMinutes >= multiAccountConfig.maxTradingTimeMinutes) {
    await switchToNextAccount(`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (${multiAccountConfig.maxTradingTimeMinutes} –º–∏–Ω)`);
    return;
  }
}
```

---

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 750-756

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ —Å–¥–µ–ª–æ–∫
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ)

**–ö–æ–¥:**
```typescript
if (multiAccountConfig.enabled && currentAccount) {
  currentAccount.tradesCount++;
  
  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ)
  checkAccountSwitchConditions().catch(error => {
    console.error('[MULTI-ACCOUNT] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:', error);
  });
}
```

---

### 6. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è ‚úÖ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server.ts`, —Å—Ç—Ä–æ–∫–∏ 2037-2120

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π:
  - `priceMonitor.onSpreadUpdate` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø—Ä–µ–¥–∞
  - `arbitrageStrategy.onSignal` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

**–í–∞–∂–Ω–æ:** –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ—Ä–≥–æ–≤–ª—è –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞ –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (`wasRunning = true`).

---

## –£—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–∏:

1. ‚úÖ **–î–æ—Å—Ç–∏–≥–Ω—É—Ç —Ü–µ–ª–µ–≤–æ–π –±–∞–ª–∞–Ω—Å** (`targetBalance`)
2. ‚úÖ **–ë–∞–ª–∞–Ω—Å < 0.5 USDT**
3. ‚úÖ **–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏** (`maxTradingTimeMinutes`)
4. ‚úÖ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–æ–º–∏—Å—Å–∏—è** (–ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏)
5. ‚úÖ **–ö—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏** (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å, rate limiting)

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤–ª–∏:

- **–î–µ—Ç–µ–∫—Ç —Å–∏–≥–Ω–∞–ª–∞:** 0ms (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)
- **–í—Ö–æ–¥ –≤ —Å–¥–µ–ª–∫—É:** 0ms (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)
- **–í—ã—Ö–æ–¥ –∏–∑ —Å–¥–µ–ª–∫–∏:** 0ms (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)

### ‚ö†Ô∏è –í–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏:

- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:** ~10-50ms (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –≤ —Ñ–æ–Ω–µ)
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞:** ~500-1000ms (–º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, –Ω–µ –≤–æ –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏)

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

- `[MULTI-ACCOUNT] START: –ê–∫–∫–∞—É–Ω—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ" (...) - –ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏`
- `[MULTI-ACCOUNT] STOP: –ê–∫–∫–∞—É–Ω—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ" (...) - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏`
- `[MULTI-ACCOUNT] SWITCH: –ê–∫–∫–∞—É–Ω—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ" (...) - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç`
- `[MULTI-ACCOUNT] CHECK: –ê–∫–∫–∞—É–Ω—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ" (...) - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π`
- `[MULTI-ACCOUNT] ERROR: –ê–∫–∫–∞—É–Ω—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ" (...) - –û—à–∏–±–∫–∞`

---

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

‚úÖ **–§–∞–∑–∞ 3 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–º–∏—Å—Å–∏–∏ ‚úÖ
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚úÖ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π ‚úÖ
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚úÖ

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ **–§–∞–∑–µ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)

–ò–ª–∏ –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ! üöÄ

